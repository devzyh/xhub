<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.devzyh.toolbox.mapper.ToolArticleMapper">

    <resultMap id="ToolArticleTagsResult" type="ToolArticle">
        <id column="id" property="id"/>
        <result column="title" property="title"/>
        <result column="url" property="url"/>
        <result column="digest" property="digest"/>
        <result column="source" property="source"/>
        <result column="created" property="created"/>
        <collection property="tags" ofType="string" javaType="java.util.List">
            <result column="tag_code"/>
        </collection>
    </resultMap>

    <select id="search" parameterType="string" resultMap="ToolArticleTagsResult">
        SELECT id, title, url, digest, source, created, tag_code
        FROM tool_article
                 LEFT JOIN tool_article_tag a ON tool_article.id = a.article_id
        WHERE title LIKE CONCAT('%', #{key}, '%')
        ORDER BY created DESC, id DESC
    </select>

    <resultMap type="ToolArticle" id="ToolArticleResult">
        <result property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="url" column="url"/>
        <result property="digest" column="digest"/>
        <result property="source" column="source"/>
        <result property="created" column="created"/>
    </resultMap>

    <sql id="selectToolArticleVo">
        select id, title, url, digest, source, created
        from tool_article
    </sql>

    <select id="selectToolArticleList" parameterType="ToolArticle" resultMap="ToolArticleResult">
        <include refid="selectToolArticleVo"/>
        <where>
            <if test="title != null  and title != ''">and title = #{title}</if>
            <if test="url != null  and url != ''">and url = #{url}</if>
            <if test="digest != null  and digest != ''">and digest = #{digest}</if>
            <if test="source != null  and source != ''">and source = #{source}</if>
            <if test="created != null ">and created = #{created}</if>
        </where>
    </select>

    <select id="selectToolArticleById" parameterType="Long" resultMap="ToolArticleResult">
        <include refid="selectToolArticleVo"/>
        where id = #{id}
    </select>

    <insert id="insertToolArticle" parameterType="ToolArticle" useGeneratedKeys="true" keyProperty="id">
        insert into tool_article
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="title != null and title != ''">title,</if>
            <if test="url != null and url != ''">url,</if>
            <if test="digest != null">digest,</if>
            <if test="source != null">source,</if>
            <if test="created != null">created,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="title != null and title != ''">#{title},</if>
            <if test="url != null and url != ''">#{url},</if>
            <if test="digest != null">#{digest},</if>
            <if test="source != null">#{source},</if>
            <if test="created != null">#{created},</if>
        </trim>
    </insert>

    <update id="updateToolArticle" parameterType="ToolArticle">
        update tool_article
        <trim prefix="SET" suffixOverrides=",">
            <if test="title != null and title != ''">title = #{title},</if>
            <if test="url != null and url != ''">url = #{url},</if>
            <if test="digest != null">digest = #{digest},</if>
            <if test="source != null">source = #{source},</if>
            <if test="created != null">created = #{created},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteToolArticleById" parameterType="Long">
        delete
        from tool_article
        where id = #{id}
    </delete>

    <delete id="deleteToolArticleByIds" parameterType="String">
        delete from tool_article where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

</mapper>
